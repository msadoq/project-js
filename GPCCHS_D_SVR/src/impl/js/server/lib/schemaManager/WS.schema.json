{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "geometry": {
            "type": "object",
            "properties": {
                "kind": {"type": "string", "default": "Relative", "enum": ["Relative", "Absolute"]},
                "x": {"type": "number"},
                "y": {"type": "number"},
                "w": {"type": "number"},
                "h": {"type": "number"}
            },
            "required": ["kind", "x", "y", "w", "h"],
            "additionalProperties": false
        },
        "docLocation": {
            "oneOf": [
                {
                    "properties": {
                        "oId": {"type": "string"}
                    },
                    "required": ["oId"]
                },
                {
                    "properties": {
                        "path": {"type": "string"}
                    },
                    "required": ["path"]
                }
            ]
        },
        "boundaries": {
            "type": "object",
            "properties": {
                "lower": {"type": "number"},
                "upper": {"type": "number"}
            },
            "required": ["lower", "upper"]
        },
        "timeLine": {
            "type": "object",
            "properties": {
                "id": {"type": "string"},
                "offset": {"type": "number", "default": 0}
            },
            "required": ["id", "offset"]
        },
        "sessionLine": {
            "allOf": [
                {"$ref": "#/definitions/timeLine"},
                {
                    "properties": {
                        "kind": {"type": "string", "enum": ["Session"]},
                        "sessionId": {"type": "number"}
                    },
                    "required": ["kind", "sessionId"]
                }
            ]
        },
        "datasetLine": {
            "allOf": [
                {"$ref": "#/definitions/timeLine"},
                {
                    "properties": {
                        "kind": {"type": "string", "enum": ["Dataset"]},
                        "dsPath": {"type": "string"}
                    },
                    "required": ["kind", "dsPath"]
                }
            ]
        },
        "recordsetLine": {
            "allOf": [
                {"$ref": "#/definitions/timeLine"},
                {
                    "properties": {
                        "kind": {"type": "string", "enum": ["Recordset"]},
                        "rsPath": {"type": "string"}
                    },
                    "required": ["kind", "rsPath"]
                }
            ]
        },
        "timeBarWindow": {
            "type": "object",
            "properties": {
                "id": {"type": "string"},
                "mode": {"type": "string", "default": "Normal", "enum": ["Normal", "Extended", "Sliding"]},
                "visuWindow": {
                    "allOf" : [
                        {"$ref": "#/definitions/boundaries"},
                        {
                            "properties": {
                                "current": {"type": "number"},
                                "defaultWidth": {"type": "number"}
                            },
                            "required": ["current"]
                        }
                    ]
                },
                "slideWindow": {"$ref": "#/definitions/boundaries"},
                "extUpperBound": {"type": "number"},
                "rulerStart": {"type": "number"},
                "rulerResolution": {"type": "number"},
                "speed": {"type": "number", "default": 1.0},
                "realTime": {"type": "boolean", "default": false},
                "timeSpec": {"type": "string", "enum": ["LocalTime"]},
                "offsetFromUTC": {"type": "number", "default": 0},
                "timeLines": {
                    "type": "array",
                    "items": {
                        "oneOf": [
                            {"$ref": "#/definitions/sessionLine"},
                            {"$ref": "#/definitions/datasetLine"},
                            {"$ref": "#/definitions/recordsetLine"}
                        ]
                    }
                },
                "masterId": {"type": "string"},
                "geometry": {"$ref": "#/definitions/geometry"}
            },
            "required": ["id", "mode", "visuWindow", "slideWindow", "extUpperBound", "rulerStart", "rulerResolution", "timeLines"],
            "additionalProperties": false
        },
        "documentWindow": {
            "type": "object",
            "properties": {
                "timeBarId": {"type": "string"},
                "pages": {
                    "type": "array",
                    "items": {"$ref": "#/definitions/docLocation"}
                },
                "geometry": {"$ref": "#/definitions/geometry"}
            },
            "required": ["timeBarId", "geometry"],
            "additionalProperties": false
        },
        "globalViewWindow": {
            "type": "object",
            "properties": {
                "kind": {"type": "string", "enum": ["GMAView", "OBAView"]},
                "timeBarId": {"type": "string"},
                "geometry": {"$ref": "#/definitions/geometry"}
            },
            "required": ["kind", "timeBarId", "geometry"],
            "additionalProperties": false
        },
        "sideWindow": {
            "type": "object",
            "properties": {
                "kind": {"type": "string", "enum": ["DocumentExplorer", "RTDExplorer", "InspectorView", "Console", "InputErrors"]},
                "geometry": {"$ref": "#/definitions/geometry"}
            },
            "required": ["kind", "geometry"],
            "additionalProperties": false
        }
    },

    "type": "object",
    "properties": {
        "data": {
            "type": "object",
            "properties": {
                "type": {"type": "string", "enum": ["WorkSpace"]},
                "attributes": {
                    "type": "object",
                    "properties": {
                        "windows": {
                            "type": "array",
                            "items": {
                                "oneOf": [
                                    {"$ref": "#/definitions/documentWindow"},
                                    {"$ref": "#/definitions/timeBarWindow"},
                                    {"$ref": "#/definitions/globalViewWindow"},
                                    {"$ref": "#/definitions/sideWindow"}
                                ]
                            }
                        }
                    },
                    "required": ["windows"]
                }
            }
        }
    }
}
