{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "definitions": {
    "boundaries": {
      "type": "object",
      "properties": {
        "lower": {"type": "number"},
        "upper": {"type": "number"}
        },
        "required": ["lower", "upper"]
    },
    "timeLine": {
      "type": "object",
      "properties": {
        "id": {"type": "string"},
        "offset": {"type": "number", "default": 0}
        },
        "required": ["id", "offset"]
    },
    "sessionLine": {
      "allOf": [
        { "$ref": "#/definitions/timeLine" },
        {
          "properties": {
            "kind": {"type": "string", "enum": ["Session"]},
            "sessionId": {"type": "number"}
          },
          "required": ["kind", "sessionId"]
        }
      ]
      },
      "datasetLine": {
        "allOf": [
          {"$ref": "#/definitions/timeLine"},
          {
            "properties": {
              "kind": {"type": "string", "enum": ["Dataset"]},
              "dsPath": {"type": "string"}
            },
            "required": ["kind", "dsPath"]
          }
        ]
      },
      "recordsetLine": {
        "allOf": [
          {"$ref": "#/definitions/timeLine"},
          {
            "properties": {
              "kind": {"type": "string", "enum": ["Recordset"]},
              "rsPath": {"type": "string"}
            },
            "required": ["kind", "rsPath"]
          }
        ]
      }
    },
    "type": "object",
    "properties": {
      "data": {
      "type": "object",
      "properties": {
	      "type" : {"type": "string", "enum" : ["timeBarConfiguration"]},
        "id": {"type": "string"},
	      "action" : {"type": "string", "enum" : ["initialUpd", "currentTimeUpd", "startTimeUpd",
          "endTimeUpd", "slideLimUpd","extendedLimUpd", "playingStateUpd", "speedUpd", "visuPosUpd",
          "visuModeUpd", "masterTlIdUpd", "tlAdded", "tlRemoved", "tlNameUpd", "tlOffsetUpd", "tbSaving"]},
        "mode": {"type": "string", "default": "Normal", "enum": ["Normal", "Extended", "Sliding"]},
        "visuWindow": {
          "allOf" : [
            {"$ref": "#/definitions/boundaries"},
            {
              "properties": {
                "current": {"type": "number"},
		            "defaultWidth" : {"type": "number"}
              },
              "required": ["current"]
            }
          ]
        },
        "slideWindow": {"$ref": "#/definitions/boundaries"},
        "extUpperBound": {"type": "number"},
	      "rulerStart": {"type": "number"},
	      "rulerResolution": {"type": "number"},
        "speed": {"type": "number", "default": 1.0},
	      "playingState": {"type": "string", "default": "pause","enum" : ["pause","replay", "realtime"]},
        "timeSpec": {"type": "string", "enum": ["OffsetFromUTC", "UTC", "LocalTime"]},
        "offsetFromUTC": {"type": "number", "default": 0},
        "masterId": {"type": "string"},
        "timeLines": {
          "type": "array",
          "items": {
            "oneOf": [
              { "$ref": "#/definitions/sessionLine" },
              { "$ref": "#/definitions/datasetLine" },
              { "$ref": "#/definitions/recordsetLine" }
            ]
          }
        }
      },
      "required": ["id", "mode", "visuWindow", "slideWindow", "extUpperBound", "timeLines"]

    }
  }
}
